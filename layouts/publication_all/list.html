{{- define "main" -}}

{{/* Require Isotope */}}
{{ $.Page.Store.Set "has_isotope" true }}

{{ partial "page_header.html" . }}

<div class="universal-wrapper">
  <div class="universal-wrapper {{ if eq .Section "publication_all" }}publication-all-page{{ end }}">
    <div class="row">
      <div class="col-lg-12">

        {{ with .Content }}
        <div class="article-style">{{ . }}</div>
        {{ end }}

        {{/* Collect years from all pages */}}
        {{ range .Pages.ByDate.Reverse }}
          {{ $year := print (.Date.Format "2006") }}
          {{ $.Scratch.SetInMap "years" $year $year }}
        {{ end }}

        <div class="form-row mb-4">

          <div class="col-auto">
            <input type="search" class="filter-search form-control form-control-sm" placeholder="{{ i18n "search_placeholder" }}" autocapitalize="off"
              autocomplete="off" autocorrect="off" role="textbox" spellcheck="false">
          </div>

          <div class="col-auto">
            <select class="pub-filters form-control form-control-sm" data-filter-group="year">
              <option value="*">Year</option>
              {{ $years_sorted := $.Scratch.GetSortedMapValues "years" }}
              {{ if $years_sorted }}
                {{ range $year := sort $years_sorted "" "desc" }}
                  <option value=".year-{{ $year }}">
                    {{ $year }}
                  </option>
                {{ end }}
              {{ end }}
            </select>
          </div>

          <div class="col-auto">
            <select class="pub-filters pubtag-select form-control form-control-sm" data-filter-group="pub_key">
              <option value="*">Keyword</option>
              {{ range $tag, $taxonomy := site.Taxonomies.pub_keys }}
                <option value=".pub_key-{{ $tag | urlize }}">{{ $tag }}</option>
              {{ end }}
            </select>
          </div>

        </div>

        <div id="container-publications">
          {{ range $index, $item := .Pages.ByDate.Reverse }}

            {{ if .Params.publication_types }}
              {{ $.Scratch.Set "pubtype" (index .Params.publication_types 0) }}
            {{ else }}
              {{ $.Scratch.Set "pubtype" 0 }}
            {{ end }}

            <div class="grid-sizer col-lg-12 isotope-item
                        pubtype-{{ $.Scratch.Get "pubtype" }}
                        year-{{ .Date.Format "2006" }}
                        {{ range .Params.categories }}category-{{ . | urlize }} {{ end }}
                        {{ with .Params.pub_keys }}{{ range . }}pub_key-{{ . | urlize }} {{ end }}{{ end }}">
              {{ partial "li_citation.html" . }}
            </div>

          {{ end }}
        </div>

      </div>
    </div>
  </div>
</div>

{{- end -}}
